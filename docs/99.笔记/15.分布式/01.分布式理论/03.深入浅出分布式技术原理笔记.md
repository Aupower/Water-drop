---
title: 《深入浅出分布式技术原理》笔记
order: 03
categories: 
  - 笔记
  - 分布式
  - 分布式理论
tags: 
  - 分布式
  - 理论
date: 2024-05-07 06:30:37
permalink: /pages/10e08a/
---

# 《深入浅出分布式技术原理》笔记

## 开篇词 掌握好学习路径，分布式系统原来如此简单

## 导读：以前因后果为脉络，串起网状知识体系

### 分布式系统解决了什么问题

- 首先，分布式系统解决了单机性能瓶颈导致的成本问题。——水平扩展
- 然后，解决了用户量和数据量爆炸性地增大导致的成本问题。——水平扩展
- 接着，满足了业务高可用的要求。——解决单点问题，鸡蛋不要都放在一个篮子里
- 最后，分布式系统解决了大规模软件系统的迭代效率和成本的问题。——分而治之，化繁为简

### 如何思考和处理分布式系统引入的新问题

- 怎么找到服务——服务注册和发现
- 怎么找到实例——路由、负载均衡
- 怎么管理配置——配置中心
- 怎么进行协同——分布式锁
- 怎么确保请求只执行一次——重试+幂等
- 怎么避免雪崩——限流、熔断、降级、快速失败、弹性扩容
- 怎么监控告警和故障恢复——分布式链路追踪

### 分布式存储如何内部协调

- 首先，理解 ACID、CAP、BASE
- 然后，确定分片策略，常见方案有 Hash、Region 分片
- 接着，确定复制方案，常见方案有：
  - 中心化方案：主从复制、一致性协议，比如 Raft 和 Paxos 等
  - 去中心化方案： Quorum 和 Vector Clock
- 最后，如何处理分布式事务
  - 分布式 ID
  - 2PC、3PC 等分布式事务方案

## 新的挑战：分布式系统是银弹吗？我看未必！

- 故障处理
- 网络不可靠——超时处理
- 时间不可靠——NTP、逻辑时钟
- 共识协同——共识性算法

## CAP 理论：分布式场景下我们真的只能三选二吗？

**在一个分布式系统中，当发生网络分区时，那么强一致性和可用性只能二选一**。

## 注册发现： AP 系统和 CP 系统哪个更合适？

服务注册的关键：

- **统一的中介存储**：调用方在唯一的地方获得被调用服务的所有实例的信息。
- **状态更新与通知**：服务实例的信息能够及时更新并且通知到服务调用方。

注册中心的特性要求：

- **可用性要求非常高**：因为服务注册发现是整个分布式系统的基石，如果它出现问题，整个分布式系统将不可用。
- **性能要求中等**：只要设计得当，整体的性能要求还是可控的，不过需要注意的是性能要求会随分布式系统的实例数量变多而提高。
- **数据容量要求低**：因为主要是存储实例的 IP 和 Port 等元数据，单个实例存储的数据量非常小。
- **API 友好程度**：是否能很好支持服务注册发现场景的“发布/订阅”模式，将被调用服务实例的 IP 和 Port 信息同步给调用方。

注册中心选择 AP 还是 CP：

因为服务发现是整个分布式系统的基石，所以可用性是最关键的设计目标。

## 负载均衡：从状态的角度重新思考负载均衡

负载均衡策略：

- 轮询
- 随机
- 加权轮询/随机
- 最少连接/请求
- 最少响应时间
- Hash
- 一致性 Hash
- 虚拟一致性 Hash

## 配置中心：如何确保配置的强一致性呢？

配置中心的关键挑战：

- **统一的配置存储**：一个带版本管理的存储系统，按服务的维度，存储和管理整个分布式系统的配置信息，这样可以很方便地对服务的配置信息，进行搜索、查询和修改。
- **配置信息的同步**：所有的实例，本地都不存储配置信息，实例能够从配置中心获得服务的配置信息，在配置修改后，能够及时将最新的配置，同步给服务的每一个实例。

配置中心特性要求：

- **可用性要求非常高**
- **性能要求中等**
- **数据容量要求低**
- **API 友好程度**

## 07 分布式锁：所有的分布式锁都是错误的？

## 重试幂等：让程序 Exactly-once 很难吗？

## 09 雪崩（一）：熔断，让故障自适应地恢复

## 10 雪崩（二）：限流，抛弃超过设计容量的请求

## 11 雪崩（三）：降级，无奈的丢车保帅之举

## 雪崩（四）：扩容，没有用钱解决不了的问题

## 13 可观测性（一）：如何监控一个复杂的分布式系统？

## 14 可观测性（二）：如何设计一个高效的告警系统？

## 故障（一）：预案管理竟然能让被动故障自动恢复？

## 16 故障（二）：变更管理，解决主动故障的高效思维方式

## 17 分片（一）：如何选择最适合的水平分片方式？

## 分片（二）：垂直分片和混合分片的 trade-off

## 19 复制（一）：主从复制从副本的数据可以读吗？

## 复制（二）：多主复制的多主副本同时修改了怎么办？

## 21 复制（三）：最早的数据复制方式竟然是无主复制？

## 22 事务（一）：一致性，事务的集大成者

## 事务（二）：原子性，对应用层提供的完美抽象

## 事务（三）：隔离性，正确与性能之间权衡的艺术

## 事务（四）：持久性，吃一碗粉就付一碗粉的钱

## 一致性与共识（一）：数据一致性都有哪些级别？

## 一致性与共识（二）：它们是鸡生蛋还是蛋生鸡？

## 一致性与共识（三）：共识与事务之间道不明的关系

## 分布式计算技术的发展史：从单进程服务到 Service Mesh

## 分布式存储技术的发展史：从 ACID 到 NewSQL

## 春节加餐 技术债如房贷，是否借贷怎样取舍？

## 春节加餐 深入聊一聊计算机系统的时间

## 春节加餐 系统性思维，高效学习和工作的利器

## 结束语 在分布式技术的大潮流中自由冲浪吧！

## 参考资料

- [深入浅出分布式技术原理](https://time.geekbang.org/column/intro/100104701``)
